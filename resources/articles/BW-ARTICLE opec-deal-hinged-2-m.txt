After months of meetings from Doha to Moscow, it was a 2 a.m. phone call between two of the most powerful men in the global oil industry that finally broke the impasse.
On the eve of the Nov. 30 meeting of the Organization of Petroleum Exporting Countries, the odds of finishing a deal to reduce supply and ease a global oil glut didn’t look good. Members remained deadlocked over how much each should reduce. They had been been forced to cancel talks aimed at getting other suppliers like Russia and Brazil to play a part.
But in the small hours of the morning of Nov. 29 Riyadh and Moscow time, Saudi Arabian Energy Minister Khalid Al-Falih and Russian counterpart Alexander Novak had talked.
Novak promised that Russia was willing not simply to freeze its output, as it had long insisted, but to cut, contributing half of the total supply reduction OPEC was seeking from competitors around the world, according to officials and ministers directly involved in the talks. In return, Al-Falih had to press the organization the next day to submit hard numbers for their own production curbs.
More from Bloomberg.com: OPEC Confounds Skeptics, Agrees to First Oil Cuts in 8 Years
Al-Falih would make good on his word. At about 5 p.m. local time on Nov. 30, OPEC announced from its Vienna headquarters that it would decrease output for the first time since 2008, by 1.2 million barrels a day. In addition, officials proudly declared that Russia and other oil producers outside the group would cut 600,000 barrels of their own. Oil prices then surged more than 15 percent to above $50 a barrel, with Brent reaching its highest level in more than a year.
“After a couple of failed attempts, OPEC finally managed to deliver,” said Olivier Jakob, managing director at consultants Petromatrix GmbH in Zug, Switzerland.
The journey to that crucial conversation had been long and hard, according to the officials. They asked not to be identified by name to describe the confidential and intimate details of how the oil-producers club put together its first production cut in almost a decade.
More from Bloomberg.com: Global Bonds Suffer Worst Monthly Meltdown as $1.7 Trillion Lost
In April, an accord between OPEC and Russia to freeze output collapsed on the day it was to be signed when Saudi Arabia unexpectedly insisted that Middle East rival Iran had to join in the agreement.
As a persistent oil surplus capped prices under $50 a barrel, battering the economies of producers around the world, efforts resumed in early September. On the sidelines of the Group of 20 economies in Hangzhou, eastern China, Russian President Vladimir Putin and Saudi Arabia Deputy Crown Prince Mohammed bin Salman agreed that Riyadh and Moscow would share the burden of the cuts.
A new round of petro-diplomacy ensued. Officials held meetings -- sometimes announced, sometimes in secret -- from Caracas to Vienna via Doha and Moscow. They exchanged ideas over the WhatsApp message system, to sketch the outlines of a deal.
More from Bloomberg.com: Wall Street Wins Again as Trump Picks Bankers, Billionaires
The next breakthrough came in Algiers on Sept. 28, when OPEC ministers decided that the group would reduce its total production, yet left the details on how much each member would undertake to be hammered out before ministers gathered again in two months. Almost two days of cumulative hours of technical discussions in the ensuing weeks proved insufficient to resolve their differences. 
As the Nov. 30 deadline approached they seemed irreconcilable.
Iran, just freed from three years of international sanctions, wanted to keep boosting oil output. Iraq, reeling from the oil-price rout and battling the Islamic State insurgency, refused to cut. Saudi Arabia, which is fighting a proxy war against Iranian-backed rebels in Yemen, wanted everyone to participate.
By Nov. 25, the agreement appeared to be unraveling when Al-Falih indicated that the kingdom was prepared to skip talks scheduled for three days later. Oil markets would re-balance in 2017 even “without an intervention from OPEC," he said, according to Saudi newspaper Asharq al-Awsat.
Meanwhile, Iranian Oil Minister Bijan Namdar Zanganeh made it clear his country was determined to go back to its output before international sanctions were imposed over its nuclear program.
After a final diplomatic push by Algerian Energy Minister Nourredine Bourtarfa, with trips to both Tehran and Moscow, ministers assembled on the morning of Nov. 30 for an informal breakfast before their main meeting. A compromise took shape: Iran would be allowed to increase output from current levels, while holding back from reaching its earlier targets.
The ministerial meeting followed and lasted more than five hours. When Al-Falih emerged from the room, aides wondered what was meant by the sudden appearance of a man who had warned he might throw in the towel again. But he’d already had the late-night call with Moscow. It turned out Al-Falih wanted some nuts to keep him going during the negotiations.
Iraq’s assent would only come hours into the discussion, when oil prices soared in response to rumors of a deal. Oil Minister Jabar Ali Al-Luaibi stepped outside the room and called his prime minister. He returned with consent to Iraq’s first OPEC production limit since 1998.
It was then Al-Falih’s turn to make a phone call, once again to Russia’s Novak. OPEC could keep up its side of the bargain, Al-Falih said, to which Novak replied that Russia was on board.
With the deal close to completion, one final problem emerged. Indonesia, which only returned to OPEC last year after a seven-year hiatus and often bought more oil than it sold, suddenly objected.
The terms of the agreement obliged the Asian country to cut output by 34,000 barrels a day, yet its delegation was permitted to authorize a reduction of just 5,000. The difference -- a minuscule 0.03 percent of global oil output -- was about to derail the biggest oil-market accord in years. A harsh solution was chosen: for a second time, Indonesia’s membership was to be suspended.
For OPEC, it was a close call, though as Iranian Oil Minister Zanganeh described it on national television: "It’s possible to be in the midst of rivalry and intense political differences and yet cooperate.”
More from Bloomberg.com
Read OPEC Deal Hinged on 2 a.m. Phone Call and It Very Nearly Failed on bloomberg.com